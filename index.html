<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Alpha Screener</title>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ffffff;
  margin: 20px;
}
.card {
  border: 1px solid #ddd;
  padding: 12px;
  margin-top: 10px;
}
.notice {
  background: #fff3cd;
  padding: 10px;
  margin-bottom: 10px;
}
button {
  padding: 10px 16px;
  font-size: 16px;
}
</style>
</head>

<body>
<div id="root">Loading Alpha Screenerâ€¦</div>

<script type="text/babel">
console.log("React script loaded");

function App() {
  const [capital, setCapital] = React.useState(50000);
  const [universe, setUniverse] = React.useState("NIFTY50");
  const [loading, setLoading] = React.useState(false);
  const [response, setResponse] = React.useState(null);
  const [error, setError] = React.useState(null);

  const API = "https://stock-screener-api-kzjj.onrender.com/api";

  const scanMarket = async () => {
    setLoading(true);
    setError(null);
    setResponse(null);

    try {
      const res = await fetch(API + "/scan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ capital, universe })
      });

      const data = await res.json();
      setResponse(data);
    } catch (e) {
      setError("Backend not reachable");
      console.error(e);
    }
    setLoading(false);
  };

  return (
    <div>
      <h2>âš¡ Alpha Screener</h2>

      <div className="notice">
        Best time to scan: <b>10:45 AM â€“ 1:30 PM IST</b><br/>
        You can scan anytime, but results are best in this window.
      </div>

      <div>
        Capital â‚¹{" "}
        <input
          type="number"
          value={capital}
          onChange={e => setCapital(e.target.value)}
        />
      </div>

      <div style={{ marginTop: "8px" }}>
        Universe{" "}
        <select value={universe} onChange={e => setUniverse(e.target.value)}>
          <option value="NIFTY50">NIFTY-50</option>
          <option value="MIDCAP">Midcap</option>
        </select>
      </div>

      <br/>
      <button onClick={scanMarket}>ðŸš€ Scan Market</button>

      {loading && <p>Scanningâ€¦ please wait</p>}
      {error && <p style={{color:"red"}}>{error}</p>}

      {response && response.status === "NO_TRADE" && (
        <p>No valid setups today. Capital protected.</p>
      )}

      {response && Array.isArray(response.results) && response.results.map((s, i) => (
        <div className="card" key={i}>
          <b>{s.symbol}</b><br/>
          Price: â‚¹{s.price}<br/>
          Target: â‚¹{s.target}<br/>
          Stop: â‚¹{s.stop}<br/>
          Qty: {s.quantity}<br/>
          Max Profit: â‚¹{s.maxProfit}<br/>
          Max Loss: â‚¹{s.maxLoss}
        </div>
      ))}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
console.log("React mounted");
</script>
</body>
</html>
